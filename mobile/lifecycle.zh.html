<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <title>应用生命周期</title>
  </head>
  <body>
    <header>
      <h1>应用生命周期</h1>

      <p>应用程序中用户体验的一个重要方面是应用如何与系统的其他部分集成在一起，以提供类似原生应用的体验，即使离线也永久可用的用户响应界面，这一点在移动设备上尤其重要，并且需要可安装在用户的主屏幕上，可重新使用（这意味着很容易将通知推送给用户，使其重新进入应用）。</p>

      <p>这些概念是整个<strong>应用生命周期</strong>的一部分：应用如何安装、显示在应用列表、启动、停止、从远程通知中唤醒、在设备在线时同步。它们构成了<strong>渐进式Web应用</strong>（PWA）的支柱。</p>
    </header>
    <main>
      <section class="featureset well-deployed">
        <h2>广泛部署的技术</h2>

        <div data-feature="可见性检测">
          <p><a data-featureid="page-visibility">页面可见性</a>规范允许开发者检测他们的应用何时在前台，从而相应地调整他们的操作和资源消耗。</p>
        </div>
      </section>

      <section class="featureset in-progress">
        <h2>开发中的技术</h2>
        <div data-feature="打包">
          <p>无论是否打包，用户都依靠各种元数据（名称、图标）在常用应用列表中来识别他们想要使用的应用。<a data-featureid="appmanifest">Web应用清单</a>规范允许开发人员将所有这些元数据放在一个 JSON 文件中。</p>
          <p>除了<a href="https://www.w3.org/TR/notifications/">Web通知</a>以外，<a data-featureid="badging">标记 API</a>定义了另一种通知机制，允许已经安装在设备上的 Web 应用（例如通过清单文件）设置一个标记，通常显示在主屏幕上应用程序的图标旁边，在应用程序的状态发生变化时通知用户可能需要注意的信息（如新消息）。</p>
        </div>

        <div data-feature="离线 Web 应用">
          <p><a data-featureid="serviceworkers">Service Workers</a> 规范描述了一种方法，该方法使应用能够利用持久的后台处理，为离线运行应用打开了大门。</p>
          <p>Service Workers 不仅可以使 Web 应用在离线或网络条件较差的情况下无缝地脱机工作，它还创建了一个模型可以使 Web 应用在浏览器窗口未打开，或者浏览器本身未运行时也能进行操作。这种能力为在后台运行 Web 应用打开了大门，并且可以对远程触发的事件作出反应。</p>
        </div>

        <div data-feature="远程通知">
          <p><a data-featureid="push">推送 API</a> 使 Web 应用能够订阅远程通知，并在接收到后唤醒应用。长期以来，原生应用受益于这些通知带来的更多的用户参与。</p>
        </div>

        <div data-feature="内容分享">
          <p><em>分享操作</em>是移动设备上通过跨应用边界传递内容的常见范例，例如将 URL 或图像发布到自己最喜欢的社交网络应用中。<a data-featureid="web-share">Web分享API</a>规范允许 Web 应用将文本、链接和其他内容分享到用户选择的任意目的地。该 API 是<a href="https://plus.google.com/116171619992010691739">Web Intents</a>提案的一个更有针对性的版本，Web Intents在2012年停止开发，部分原因是它的一般性引发了用户体验问题。</p>
          <p><a data-featureid="web-share-target">Web分享目标API</a>建议允许Web应用在其应用清单中声明其可接收来自其他应用的内容。这允许用户选择安装的Web应用在分享菜单中被其他本地应用列出。</p>
        </div>

        <div data-feature="地理围栏">
          <p>通过对后台操作的支持，<a data-featureid="geolocation-sensor">地理位置传感器</a>规范允许在设备进入指定的地理区域（也称为地理围栏）时唤醒Web应用。</p>
        </div>
      </section>

      <section class="featureset exploratory-work">
        <h2>探索性工作</h2>

        <div data-feature="打包">
          <p><a data-featureid="packaging">Web 打包</a>文档描述了用于网站和应用的新包格式的用例，并概述了这种格式。</p>
        </div>

        <div data-feature="状态转换">
          <p>在移动设备上运行的应用可以通过不同的状态，从运行到空闲、暂停、停止、丢弃或终止。这些状态之间的转换由底层操作系统触发，并从 Web 应用中隐藏。<a data-featureid="page-lifecycle">页面生命周期</a>方案旨在向应用公开状态转换，以便这些应用能够保持/恢复状态、启用/禁用网络等。</p>
        </div>

        <div data-feature="无缝切换">
          <p>很多网站会在其自己的用户界面内嵌入来自第三方来源的内容（例如新闻内容），或者将第三方内容加载到 iframe 中以提供更快、可靠的加载体验，这对于移动设备尤其重要。这种方法的一个主要缺点是不保留第三方的来源：只有第一方的来源出现在地址栏中，这使得用户难以识别他们正在浏览的内容的出处和可信度。另一个缺点是第三方页面无法利用附加到其源的客户端资源和权限。<a data-featureid="portals">Portals</a>是一个在网站或网页之间实现无缝切换的提案，它使一个页面能够嵌入另一个页面，并在嵌入状态和切换后的全屏状态之间无缝转换，从而解决上述源的问题。</p>
        </div>

        <div data-feature="后台执行">
          <p><a data-featureid="background-sync">Web 后台同步</a>规范建立在 Service Workers 之上，通过在后台运行网络操作，使 Web 应用能够无缝地保持用户数据的最新状态，从而适应用户在移动设备上可能经常遇到的不可靠的连接。</p>

          <p><a data-featureid="background-fetch">Background Fetch</a> 定义了一个类似的基于 Service Workers 的后台下载和上传机制，但允许以用户可见的方式让操作在后台继续进行，即使是在用户关闭了所有浏览器窗口和 worker 的情况下。该规范专门用于支持下载和上传大型资源（如播客、电影、纹理）。</p>
        </div>
      </section>

      <section>
        <h2>不再进行的工作</h2>

        <dl>
          <dt>应用缓存</dt>
          <dd><a data-featureid="appcache">应用缓存</a>机制是在HTML5中引入的。通过一个缓存清单，浏览器能够知道哪些文件需要被保留在缓存中，从而允许脱机访问Web应用。该特性已经被所有的主流浏览器实现，但存在安全问题，而且开发人员对缓存的控制极其有限，所以该功能在HTML 5.1中已不推荐使用，并于HTML 5.2中删除。<a href="https://www.w3.org/TR/service-workers-1/">Service Workers</a>规范定义了一种更加强大的替代方法。</dd>

          <dt>任务调度</dt>
          <dd><a data-featureid="task-scheduler">任务调度 API</a> 可以通过与 Web 应用关联的 service worker 在指定的时间触发任务。该规范属于现在已经关闭的系统应用工作组（System Applications Working Group）的范围，因此被搁置了。</dd>

          <dt>地理围栏 API</dt>
          <dd><a data-featureid="geofencing">地理围栏 API</a> 可以在设备进入指定的地理区域时唤醒Web应用。这项工作已经停止，部分原因在于未能找到一种很好的方法来解决有关隐私的权限问题，还因为该 API 依赖于当时还不稳定的 <a href="https://w3c.github.io/ServiceWorker/">Service Workers</a>。通过对后台操作的支持，<a href="https://www.w3.org/TR/geolocation-sensor/">地理位置传感器</a>规范现在提供了类似的功能。</dd>

          <dt>后台执行控制</dt>
          <dd>用户代理会限制 Web 应用在后台执行操作的能力，使应用可以执行的操作的控制权掌握在用户手中。<a data-featureid="budget-api">Web预算API</a>开发了一种机制，通过该机制，应用可以确定可在后台运行操作的成本和预算，从而允许他们决定是执行还是推迟这些操作。各种参数可能影响操作的成本，包括设备是否使用电池电源以及设备所连接的网络类型等。由于<a href="https://github.com/WICG/budget-api/issues/23#issuecomment-413224865">使用过少</a>以及<a href="https://discourse.wicg.io/t/proposal-budget-api/1717/7">此API设计的问题</a>，该提案被撤销。</dd>
        </dl>
      </section>
    </main>
    <script src="../js/generate.js"></script>
  </body>
</html>
